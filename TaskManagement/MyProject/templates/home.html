{% extends 'header.html' %}
{% block title %}Home {% endblock %}
{% load static %}
{% block cssLink %}<link rel="stylesheet" href="{% static 'css/home.css' %}">{% endblock %}

{% block header %}
{% if isAuthenticated %}

<!-- hi {{instance.name}}
{{instance.password}} -->

<div id="dashboard-container" >
  <h1>Dashboard</h1>

  <div id="lr-container" >
    <div id="l-container" >
      <button onclick="createTask()" id="create-task-btn" >Create task</button>
      <button onclick="ongoingTasks()" id="ongoing-tasks-btn" >Ongoing tasks</button>
    </div>

    <div id="r-container" >
      <div id="create-task-container" hidden >
        <h1>Create a Task</h1>
        <form id="sForm" method="post" action="http://127.0.0.1:8000/addTask/">
          {% csrf_token %}
          <input type="text" placeholder="TaskTitle" name="title" class="inputField">
          <br>
          <textarea id="textAr" name="description">TaskDescription</textarea>
          <br>
          <h2>Deadline</h2>
          <input type="date" id="deadlineDate" name="deadline">
          <h2 id="aTo">AssignTo</h2>
          <input type="hidden" id="assignTo" name="employed" value="">

        </form>

        <div class="availaibleMembers" id="memberContainer">


        </div>
        <button onclick="submitForm()" class="subBtn">Create</button>

      </div>

      <table id="ongoing-tasks-table" hidden >
        <tr>
          <th>S. No.</th>
          <th>Task title</th>
          <th>Deadline</th>
          <th>Assigned by:</th>
        </tr>
        <tr>
          <td>1.</td>
          <td>r2c2</td>
          <td>r2c3</td>
          <td>r2c4</td>
        </tr>
      </table>
    </div>
  </div>
</div>
<script>
  var sForm=document.getElementById('sForm')
  var availaibleMember=document.getElementById('memberContainer')
  var validMember=({{instance.activeConnections | safe}})['connections']
  var i=0
  validMember.map((result)=>{
    var newEle=document.createElement('div')
    newEle.classList.add('memberCard')
    newEle.id=i
    newEle.setAttribute('onclick',`buttonPicker(${i})`)
    newEle.innerHTML=result
    availaibleMember.appendChild(newEle)
    i++
  })

  var active;

  function buttonPicker(id)
  {
    if(active){
      active.classList.remove('active')
    }
    active=document.getElementById(id)
    active.classList.add('active')
    document.getElementById('assignTo').value=validMember[id]
  }

  function submitForm(){
    console.log()
    console.log(sForm)
    sForm.submit()
  }
</script>

<script>
  const create_task_container = document.getElementById("create-task-container");
  const ongoing_tasks_table = document.getElementById("ongoing-tasks-table");

  function createTask() {
    ongoing_tasks_table.hidden = true;
    create_task_container.hidden = false;
  }

  function ongoingTasks() {
    create_task_container.hidden = true;
    ongoing_tasks_table.hidden = false;
  }
</script>

{% else %}

<div id="col" >
  <div>
    <div id="home-div-p" >
      <p class="switch" id="create" >
        Create tasks,
      </p>
      <p class="switch" id="manage" >
        Manage them
      </p>
      <p class="switch"  id="assign" >
        Assign!
      </p>
    </div>

    <div>
      <a href="/account/login" class="btn" id="home-div-a" >Get started</a>
    </div>
  </div>

  <img src="{% static 'resources/bg.png' %}" />
</div>

<script>
  const c = document.getElementById("create"), m = document.getElementById("manage"), a = document.getElementById("assign");
  function styleFn() {
    setTimeout(() => {
      a.style.color = "black";
      a.style.opacity = "0.1";
      c.style.color = "#06D6A0";
      c.style.opacity = "1";
    }, 1000);

    setTimeout(() => {
      c.style.color = "black";
      c.style.opacity = "0.1";
      m.style.color = "#FF5E5B";
      m.style.opacity = "1";
    }, 2000);

    setTimeout(() => {
      m.style.color = "black";
      m.style.opacity = "0.1";
      a.style.color = "#118AB2";
      a.style.opacity = "1";
    }, 3000);

    setTimeout(() => {
      styleFn();
    }, 3000);
  }

  styleFn();
</script>
{% endif %}

{% if messages %}
    {% for message in messages %}
        <div style="
        width: 150px;
        font-size: x-large;
        border-left: 4px solid red;
        border-radius: 5px;
        box-shadow: 0 0 10px 2px #d9d9d9;
        position: absolute;
        top: 10vh;
        left: -30vw;
        transition: left 700ms ease;
        " id="err-msg" >
            {{message}}
        </div>

        <script>
          setTimeout(() => {
            document.getElementById("err-msg").style.left = "3vw";
            setTimeout(() => {
              document.getElementById("err-msg").hidden = true;
            }, 2500);
          }, 500);
        </script>
    {% endfor %}
{% endif %}

{% endblock %}
